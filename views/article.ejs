<section class="mb-8">
  <h1 class="text-3xl md:text-4xl font-bold tracking-tight mb-2"><%= article.title %></h1>
  <% if (article.date) { %>
    <p class="text-sm text-slate-500 dark:text-slate-400"><%= new Date(article.date).toLocaleDateString() %></p>
  <% } %>
  <% if (article.tags && article.tags.length) { %>
    <div class="mt-3 flex flex-wrap gap-1.5">
      <% article.tags.forEach(tag => { %>
        <span class="inline-block rounded-full bg-slate-100 text-slate-700 text-xs px-2 py-1 dark:bg-slate-800 dark:text-slate-200"><%= tag %></span>
      <% }) %>
    </div>
  <% } %>
  <div class="mt-6">
    <a href="/" class="inline-flex items-center gap-2 text-sm text-brand-700 hover:text-brand-600">
      <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M7.707 14.707a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 0-1.414l4-4A1 1 0 0 1 8 6v2h6a1 1 0 1 1 0 2H8v2a1 1 0 0 1-.293.707Z"/></svg>
      Back to home
    </a>
  </div>
</section>

<section class="grid grid-cols-1 lg:grid-cols-[1fr_260px] gap-10">
  <div>
    <div class="prose prose-slate dark:prose-invert max-w-none prose-a:text-brand-700 hover:prose-a:text-brand-600 prose-img:rounded-lg js-article">
      <%- content %>
    </div>
  </div>
  <aside class="hidden lg:block sticky top-24 self-start">
    <div class="rounded-lg border border-slate-200 bg-white p-4 dark:border-slate-700 dark:bg-slate-900">
      <h2 class="text-sm font-semibold mb-2">On this page</h2>
      <nav id="toc" class="text-sm text-slate-600 dark:text-slate-300"></nav>
    </div>
  </aside>
</section>

<script>
  (function () {
    const container = document.querySelector('.js-article');
    const toc = document.getElementById('toc');
    if (!container || !toc) return;
    const headings = container.querySelectorAll('h2, h3, h4');
    if (!headings.length) {
      toc.parentElement.classList.add('hidden');
      return;
    }
    const ul = document.createElement('ul');
    ul.className = 'space-y-2';
    headings.forEach((h) => {
      if (!h.id) {
        h.id = h.textContent.trim().toLowerCase().replace(/[^\w]+/g, '-');
      }
      h.classList.add('scroll-mt-24');
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${h.id}`;
      a.textContent = h.textContent;
      a.className = 'block hover:text-brand-700';
      if (h.tagName === 'H3') li.classList.add('ml-3');
      if (h.tagName === 'H4') li.classList.add('ml-6');
      li.appendChild(a);
      ul.appendChild(li);
    });
    toc.appendChild(ul);
  })();
</script>
